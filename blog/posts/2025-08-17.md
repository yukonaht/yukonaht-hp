---
title: ブログを書くのが面倒くさかったので、マークダウンを変換できるようにしてみた
date: 2025-08-17
thumb: ./img/thumbnail.png
tags: [talus, program]
---

- [注意](#注意)
- [概要](#概要)
- [環境](#環境)
- [詳細](#詳細)
- [最後に](#最後に)

## 注意

このサイトの制作にあたって、ChatGPTを使ってコーディングしています。

## 概要

HTMLとJavascriptを用いて、`md`形式で書いたブログをHTMLとして表示できるようにしました。

HTML直打ちを毎回はつらすぎるので…

`posts/`内の拡張子が`.md`のファイルを一覧にするnode.jsを用いた`build.js`と、それを読み取ってページ一覧を生成する`index.html`、ページを表示させる`preview.html`で構成されてます。

## 環境

- Ubuntu 24.04 LTS
- VSCode

## 詳細

詳しくはこのページと[一覧ページ](./)を見てもらえばわかります。

```js:build.js
const posts = files.map(file => {
    const fullPath = path.join(postsDir, file);
    const raw = fs.readFileSync(fullPath, "utf-8");
    const { data } = matter(raw);

    // 日付を YYYY-MM-DD 形式に整形
    let dateStr = "";
    if (data.date) {
        const d = new Date(data.date);
        if (!isNaN(d)) {
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const dd = String(d.getDate()).padStart(2, "0");
        dateStr = `${yyyy}-${mm}-${dd}`;
        }
    }

    return {
        title: data.title || file.replace(/\.md$/, ""),
        date: dateStr,
        file,               // preview.html?file= で使用
        thumb: data.thumb || "thumbnail.png",
        tags: data.tags || []
    };
});
```
```json:posts.json
{
    "title": "ブログを書くのが面倒くさかったので、マークダウンを変換できるようにしてみた",
    "date": "2025-08-17",
    "file": "2025-08-17.md",
    "thumb": "./img/thumbnail.png",
    "tags": [
        "talus",
        "program"
    ]
}
```

`build.js`で`gray-matter`を用いて記事データを`posts.json`に保存、

```js:index.html
fetch("posts.json")
    .then(r => r.json())
    .then(posts => {
        allPosts = Array.isArray(posts) ? posts : [];
        const displayed = requestTag ? allPosts.filter(p => Array.isArray(p.tags) && p.tags.includes(requestTag)) : allPosts;
        renderPosts(displayed);
    })
    .catch(err => {
        list.innerHTML = "<p>投稿の読み込みに失敗しました。</p>";
        console.error(err);
    });
```
そして、`index.html`で`posts.json`から記事一覧を読み込んでいます。

```html:preview.html
<div id="content">Loading...</div>

<!-- 既存のコード… -->

<script>
    // 既存のコード…

    const renderer = {
        code(...args) {
            let token = typeof args[0] === "string"
                ? { text: args[0], lang: (args[1] || "").trim() }
                : (args[0] || { text: "", lang: "" });

            // "html:index.html" → language / filename
            const info = (token.lang || "").trim();
            let [language, filename = ""] = info.split(":");
            language = (language || "").trim();
            filename = filename.trim();

            // ファイル名が無いときは言語名をラベルにする
            const label = filename || language;

            // ハイライト or エスケープ
            let html;
            if (window.hljs) {
                if (language && hljs.getLanguage(language)) {
                    html = hljs.highlight(token.text, { language }).value;
                } else {
                    html = hljs.highlightAuto(token.text).value;
                }
            } else {
                html = escapeHtml(token.text);
            }

            return `
                <div class="code-block">
                ${label ? `<div class="code-filename">${label}</div>` : ""}
                <pre><code class="language-${language}">${html}</code></pre>
                </div>
            `;
        }
    };

    marked.use({ renderer });

    // Markdown 本文
    const mdDiv = document.createElement("div");
    mdDiv.innerHTML = marked.parse(text);
    container.appendChild(mdDiv);

    // 既存のコード…
</script>
```

## 最後に

これからこの仕組みを使ってどんどんブログを書いていこうと思っています！

気になる人はぜひ、ブックマークなどに登録してもらえると嬉しいです！